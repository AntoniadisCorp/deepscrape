<main
  class="relative inset-0 min-h-full bg-gray-200 dark:bg-gray-900 h-full flex items-center justify-center">
  <section class="inset-0 h-full w-full">
    <div class="relative w-full bg-cover bg-no-repeat">
      <div class="container mx-auto py-8 h-full">
        <div
          class="flex flex-col items-center justify-center min-h-[calc(100vh-8rem)] space-y-8 h-full content-center">
          <div id="recaptcha-verification" #recaptcha></div>
          <div
            class="text-center space-y-6 max-w-md text-gray-800 dark:text-gray-200">
            <h2 class="text-3xl font-medium">Welcome</h2>
            <p class="text-lg">
              Please verify your account to access the dashboard.
            </p>
          </div>
          <div class="w-full px-4 max-w-2xl">
            <div
              class="justify-center items-center content-center group relative mt-10 mb-3 flex w-full min-w-0 flex-col break-words rounded-lg border-0 bg-deep-purple-100 bg-opacity-60 shadow-lg dark:bg-gray7 p-6">
              @if (errorMessage) {
              <div
                class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mt-4 w-full"
                role="alert">
                <span class="block sm:inline">{{ errorMessage }}</span>
              </div>
              } @if (verificationMethod === 'email') {
              <div class="mb-3 text-center">
                <h1 class="text-xl font-bold text-gray-800 dark:text-gray-200">
                  Email Verification
                </h1>
              </div>
              <p class="text-center text-gray-600 dark:text-gray-400 mb-6">
                A verification email has been sent to your inbox.
              </p>
              <div
                class="px-6 [&:last-child]:pb-6 space-y-4 flex flex-col items-center justify-start w-full">
                <div
                  data-slot="alert"
                  role="alert"
                  class="relative text-start h-auto text-gray-100 dark:text-gray-400 w-full rounded-lg border px-4 py-3 text-sm flex flex-row gap-x-3 gap-y-0.5 items-start size-4 translate-y-0.5 text-current">
                  <mat-icon
                    fontSet="material-icons-outlined"
                    class="w-10 h-auto">
                    email
                  </mat-icon>
                  <div
                    data-slot="alert-description"
                    class="col-start-2 w-full grid justify-items-start gap-1 text-sm">
                    Verification email sent to
                    <strong>{{ user?.email }}</strong>
                  </div>
                </div>
                <div class="w-full mt-6 flex flex-col space-y-4">
                  <button
                    (click)="resendVerificationEmail()"
                    [disabled]="loading.email"
                    class="w-auto cursor-pointer border-2 text-base dark:text-purple-50 dark:bg-purple-800/70 dark:active:bg-dark-600 dark:hover:bg-purple-800 dark:hover:text-purple-100 dark:border-gray-100 border-purple-400 bg-gray-100 text-purple-400 hover:bg-purple-400 active:bg-gray-700 hover:text-white active:text-white font-semibold rounded-lg transition-all duration-300 shadow outline-none ease-in-out focus:outline-none">
                    @if(loading.email) {
                    <div class="flex justify-center items-center">
                      <div
                        class="animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-purple-500"></div>
                    </div>
                    } @else {
                    <span>Resend Verification Email</span>
                    }
                  </button>
                  <button
                    (click)="goToLogin()"
                    [disabled]="loading.logout"
                    class="w-auto cursor-pointer rounded dark:active:bg-gray-600/70 bg-gray-500 px-6 py-3 text-sm font-bold uppercase text-white shadow outline-none transition-all duration-150 ease-in-out hover:bg-gray-600 focus:outline-none active:bg-gray-700 dark:bg-gray-700/[0.4] dark:hover:bg-gray-700/[0.7]">
                    @if(loading.logout) {
                    <div class="flex justify-center items-center">
                      <div
                        class="animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-purple-500"></div>
                    </div>
                    } @else {
                    <span>Go to Login</span>
                    }
                  </button>
                </div>
              </div>
              } @else if (verificationMethod === 'phone') {
              <div class="mb-3 text-center">
                <h1 class="text-xl font-bold text-gray-800 dark:text-gray-200">
                  Phone Number Verification
                </h1>
              </div>
              <p class="text-center text-gray-600 dark:text-gray-400 mb-6">
                Please verify your phone number to access the dashboard.
              </p>
              <form
                [formGroup]="phoneVerificationForm"
                (ngSubmit)="sendPhoneVerificationCode()">
                <div class="relative mb-3 w-full">
                  <label
                    class="mb-2 block text-xs font-bold uppercase text-gray-400 dark:text-gray-400"
                    for="phone-number-verify">
                    Phone Number
                  </label>
                  <input
                    id="phone-number-verify"
                    formControlName="phoneNumber"
                    required
                    type="text"
                    placeholder="+1234567890"
                    class="w-full rounded border-0 bg-slate-600/50 px-3 py-3 text-sm text-gray-200 placeholder-gray-400 shadow ring-[#3d77f3] transition-all duration-150 ease-linear focus:outline-none focus:ring dark:bg-gray5 dark:text-gray2" />
                  @if (phoneVerificationForm.get('phoneNumber')?.invalid &&
                  (phoneVerificationForm.get('phoneNumber')?.dirty ||
                  phoneVerificationForm.get('phoneNumber')?.touched)) {
                  <small class="text-red-500">
                    @if
                    (phoneVerificationForm.get('phoneNumber')?.errors?.['required'])
                    { Phone number is required. } @if
                    (phoneVerificationForm.get('phoneNumber')?.errors?.['pattern'])
                    { Invalid phone number format (e.g., +1234567890). }
                  </small>
                  }
                </div>
                <div class="mt-6 text-center">
                  <button
                    type="submit"
                    title="send-code-verify"
                    [disabled]="
                      !phoneVerificationForm.get('phoneNumber')?.valid ||
                      loading.phone ||
                      confirmationResult
                    "
                    class="mb-1 mr-1 w-full cursor-pointer bg-gradient-to-r from-green-400 to-blue-400 hover:from-green-500 hover:to-blue-500 transform hover:scale-105 rounded dark:bg-blue-600/[0.4] dark:hover:bg-blue-600/[0.7] disabled:bg-gray-900 dark:disabled:bg-gray-900 px-6 py-3 text-sm font-bold uppercase text-white shadow outline-none transition-all duration-150 ease-in-out hover:shadow-lg focus:outline-none active:bg-gray-700">
                    @if(loading.phone) {
                    <div class="flex justify-center items-center">
                      <div
                        class="animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-green-500"></div>
                    </div>
                    } @else {
                    <span>SEND VERIFICATION CODE</span>
                    }
                  </button>
                </div>
              </form>

              @if (confirmationResult) {
              <div>
                <div class="relative mb-3 w-full mt-4">
                  <label
                    class="mb-2 block text-xs font-bold uppercase text-gray-400 dark:text-gray-400"
                    for="verification-code-verify">
                    Verification Code
                  </label>
                  <input
                    id="verification-code-verify"
                    formControlName="verificationCode"
                    required
                    type="text"
                    placeholder="Enter 6-digit code"
                    class="w-full rounded border-0 bg-slate-600/50 px-3 py-3 text-sm text-gray-200 placeholder-gray-400 shadow ring-[#3d77f3] transition-all duration-150 ease-linear focus:outline-none focus:ring dark:bg-gray5 dark:text-gray2" />
                  @if (phoneVerificationForm.get('verificationCode')?.invalid &&
                  (phoneVerificationForm.get('verificationCode')?.dirty ||
                  phoneVerificationForm.get('verificationCode')?.touched)) {
                  <small class="text-red-500">
                    @if
                    (phoneVerificationForm.get('verificationCode')?.errors?.['required'])
                    { Verification code is required. } @if
                    (phoneVerificationForm.get('verificationCode')?.errors?.['minlength']
                    ||
                    phoneVerificationForm.get('verificationCode')?.errors?.['maxlength'])
                    { Code must be 6 digits. }
                  </small>
                  }
                </div>
                <div class="mt-6 text-center">
                  <button
                    (click)="verifyPhoneNumberCode()"
                    type="button"
                    title="verify-code-verify"
                    [disabled]="
                      !phoneVerificationForm.get('verificationCode')?.valid ||
                      loading.code
                    "
                    class="mb-1 mr-1 w-full cursor-pointer bg-gradient-to-r from-purple-400 to-pink-400 hover:from-purple-500 hover:to-pink-500 transform hover:scale-105 rounded dark:bg-blue-600/[0.4] dark:hover:bg-blue-600/[0.7] disabled:bg-gray-900 dark:disabled:bg-gray-900 px-6 py-3 text-sm font-bold uppercase text-white shadow outline-none transition-all duration-150 ease-in-out hover:shadow-lg focus:outline-none active:bg-gray-700">
                    @if(loading.code) {
                    <div class="flex justify-center items-center">
                      <div
                        class="animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-purple-500"></div>
                    </div>
                    } @else {
                    <span>VERIFY CODE</span>
                    }
                  </button>
                  <button
                    type="button"
                    title="reset-phone-auth-verify"
                    (click)="resetPhoneVerification()"
                    class="mt-3 mb-1 mr-1 w-full cursor-pointer bg-gray-600 hover:bg-gray-700 rounded px-6 py-3 text-sm font-bold uppercase text-white shadow outline-none transition-all duration-150 ease-in-out hover:shadow-lg focus:outline-none active:bg-gray-800">
                    <span>BACK / CANCEL</span>
                  </button>
                </div>
              </div>
              } } @else if (loading.email && !verificationMethod) {

              <div class="flex justify-center items-center">
                <div
                  class="animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-purple-500"></div>
              </div>
              }
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
</main>
